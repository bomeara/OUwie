<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculation Update • OUwie</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Calculation Update">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">OUwie</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.18</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/calculationUpdate.html">Calculation Update</a>
    </li>
    <li>
      <a href="../articles/hOUwieStarterGuide.html">hOUwie User Guide</a>
    </li>
    <li>
      <a href="../articles/OUwie_2.1_adds.html">New additions as of OUwie 2.1</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/thej022214/OUwie/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Calculation Update</h1>
                        <h4 data-toc-skip class="author">Priscilla Lau,
Bjørn Kopperud, Sebastian Höhna, Jeremy Beaulieu, and Brian O’Meara</h4>
            
            <h4 data-toc-skip class="date">11/06/2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/thej022214/OUwie/blob/HEAD/vignettes/calculationUpdate.Rmd" class="external-link"><code>vignettes/calculationUpdate.Rmd</code></a></small>
      <div class="hidden name"><code>calculationUpdate.Rmd</code></div>

    </div>

    
    
<p>There was an issue in OUMA and OUMVA models in OUwie versions from
its origin through 2.17. This has now been fixed. Details below:</p>
<div class="section level3">
<h3 id="timeline">Timeline<a class="anchor" aria-label="anchor" href="#timeline"></a>
</h3>
<p>Priscilla Lau reached out to Jeremy Beaulieu in Aug, 2025, at a
conference about an issue she and her collaborators (Bjørn Kopperud and
Sebastian Höhna) found in how OUwie calculates the variance-covariance
matrix under the OU model when there are different alphas, as well as an
error in one of the equations in the original Beaulieu et al. (2012)
paper. She followed up with an email on Sept 3, 2025; after a discussion
of how best to handle this, we put a warning on the use of models with
different alphas in OUwie (on Sept. 6, 2025). A further email from
Priscilla and colleagues had additional details on the issues.</p>
</div>
<div class="section level3">
<h3 id="equation-error-in-paper">Equation error in paper<a class="anchor" aria-label="anchor" href="#equation-error-in-paper"></a>
</h3>
<p>In the appendix on page 2383 when it describes the covariation under
an OU_MVA model, the final term is <strong>latex</strong>_ when it
should be <strong><em>latex</em></strong>, as it is correctly written in
equation A.26. This is unrelated to the issue below but still worth
noting.</p>
</div>
<div class="section level3">
<h3 id="variance-covariance-matrix-calculation-error-in-ouwie">Variance-covariance matrix calculation error in OUwie<a class="anchor" aria-label="anchor" href="#variance-covariance-matrix-calculation-error-in-ouwie"></a>
</h3>
<p>Second, and of great practical significance, the way OUwie calculated
the variance-covariance matrix under the OU model with multiple alphas
was indeed incorrect. With an Ornstein-Uhlenbeck process, shared
variance decays based on the alpha parameter: with stronger alpha, what
matters more is where two tips are being pulled to rather than their
shared history. When calculating this up the tree, OUwie versions before
2.18 used a constant alpha rather than varying it based on the different
regimes. This means that the variance-covariance matrix and weight
vectors were calculated incorrectly when there are multiple alphas
(OUMVA and OUMA models).</p>
<p>Adopting the corrections proposed by Priscilla Lau and colleagues, we
have updated the code in OUwie version 2.18 (released Nov. 6, 2025) to
correctly calculate the variance-covariance matrix under the OU model
with multiple alphas. We thank Priscilla Lau, Bjørn Kopperud, and
Sebastian Höhna for their careful work in identifying this issue and
proposing a solution.</p>
</div>
<div class="section level3">
<h3 id="faq">FAQ<a class="anchor" aria-label="anchor" href="#faq"></a>
</h3>
<p><strong>How big of a difference does this make?</strong></p>
<p>The exact impact will depend on the tree, the alpha values, and the
data. In some cases it could be substantial. There is no predicted
effect of whether this makes OUMVA or OUMA models seem to fit better or
worse than they should otherwise.</p>
<p><strong>Are the equations in the Beaulieu et al. (2012) paper
correct?</strong></p>
<p>Other than the one noted above, yes. So other software that
implemented the equations correctly should be fine, this is just an
issue with how OUwie implemented the calculations.</p>
<p><strong>Can I verify how this affects my analyses?</strong></p>
<p>Yes, with OUwie() and similar functions we have added a
<code>corrected</code> argument that defaults to <code>'auto'</code>
where it uses the newer, currently slower algorithm for models with
heterogeneous alpha and the old algorithm for the ones where this
doesn’t matter. If you set <code>corrected=FALSE</code>, it will always
use the old method for calculating the variance-covariance matrix, and
if you set <code>corrected=TRUE</code>, it will always use the new
method. You can compare results with <code>corrected=TRUE</code> and
<code>corrected=FALSE</code> to see how much of a difference it makes
for your specific analysis. We wanted to make sure that any problems are
transparent and reproducible.</p>
<p><strong>Will this affect OUwie in general?</strong></p>
<p>Given how we implemented this, OUwie will run more slowly for OUMA
and OUMVA models.</p>
<p>We’ll be updating this to make it faster (probably also automatically
switching between algorithms) in future versions of OUwie, but we wanted
to put out a slow but correct version as soon as possible.</p>
<p><strong>Was hOUwie affected?</strong></p>
<p>Yes, in the same way, and corrected in the same way.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jeremy Beaulieu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
